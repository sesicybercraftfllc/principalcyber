<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cybercraft</title>
    <style>
        /* PALETA DE CORES TERROSAS */
        :root {
            --cor-background: #f7f4e9; /* Bege claro / Off-White */
            --cor-principal: #6b4423;    /* Marrom Café */
            --cor-secundaria: #8b5e34;  /* Marrom Médio */
            --cor-borda: #d4c7b2;       /* Bege acinzentado */
            --cor-texto-principal: #333;
            --cor-destaque-usuario: #4a784d; /* Verde Musgo */
            --cor-destaque-dev: #e0c29a;     /* Ocre/Bege Quente */
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px;
            background-color: var(--cor-background); 
            color: var(--cor-texto-principal);
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background-color: #fff; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
        }
        h1 { 
            text-align: center; 
            color: var(--cor-principal); 
            border-bottom: 2px solid var(--cor-borda); 
            padding-bottom: 10px;
        }
        h2, h3 { color: var(--cor-secundaria); }
        
        /* Formulários e Painéis */
        #login-form, #dev-panel { 
            margin-top: 20px; 
            padding: 20px; 
            border: 1px solid var(--cor-borda); 
            border-radius: 8px; 
            background-color: #ffffff;
        }
        #login-form input[type="text"], #login-form input[type="password"],
        #dev-panel input[type="text"], #dev-panel select, #item-file { 
            padding: 10px; 
            margin-bottom: 12px; 
            width: 100%; 
            box-sizing: border-box; 
            border: 1px solid var(--cor-borda);
            border-radius: 4px;
        }
        /* Botão de Arquivo */
        #item-file { padding: 5px; }

        /* Botões */
        button { 
            padding: 10px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            transition: background-color 0.3s;
        }
        /* Botão Desenvolvedor */
        #login-form button { 
            background-color: var(--cor-principal); 
            color: white; 
            width: 100%;
        }
        #login-form button:hover { background-color: #4a2f1c; }

        /* Botão Usuário */
        #login-section button:last-of-type { 
            background-color: var(--cor-destaque-usuario); 
            color: white; 
            width: 100%;
            margin-top: 15px;
        }
        #login-section button:last-of-type:hover { background-color: #3b603e; }

        /* Botões Sair e Ações Dev */
        #dev-panel button, #user-view button { 
            background-color: var(--cor-secundaria); 
            color: white;
        }
        #dev-panel button:hover, #user-view button:hover { background-color: var(--cor-principal); }
        
        /* Estilo dos Links/Arquivos */
        .file-item a { color: var(--cor-principal); text-decoration: none; font-weight: bold;}
        .file-item a:hover { text-decoration: underline; }
        .dev-info { font-size: 0.85em; color: var(--cor-secundaria); margin-top: 5px; }

        /* Visualização do Usuário */
        #user-view h2 { color: var(--cor-destaque-usuario); }
        .file-item { 
            border: 1px solid var(--cor-borda); 
            padding: 15px; 
            margin-bottom: 10px; 
            border-radius: 6px; 
            background-color: #fffaf0; 
        }
        .file-item img, .file-item video { max-width: 100%; height: auto; border-radius: 4px; margin-top: 10px; }
        
        /* Painel do Desenvolvedor */
        .dev-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border: 1px solid var(--cor-destaque-dev); 
            padding: 10px; 
            margin-bottom: 10px; 
            border-radius: 6px; 
            background-color: var(--cor-destaque-dev); 
            color: var(--cor-principal);
        }
        .dev-item span strong { color: var(--cor-principal); }
        .dev-item > span { width: 70%; } /* Ajuste para o texto não invadir os botões */

        .folder-selector { margin-bottom: 20px; }
        .folder-selector button {
            background-color: var(--cor-borda);
            color: var(--cor-texto-principal);
            margin-right: 5px;
        }
        .folder-selector button.active {
            background-color: var(--cor-principal);
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Cybercraft</h1>

        <div id="login-section">
            <div id="login-form">
                <h3>Login do Desenvolvedor</h3>
                <input type="text" id="username" placeholder="Usuário">
                <input type="password" id="password" placeholder="Senha">
                <button onclick="developerLogin()">Entrar como Desenvolvedor</button>
            </div>
            <p style="text-align: center;">Ou</p>
            <button onclick="userLogin()">Entrar como Usuário Comum (Visualização)</button>
        </div>

        <div id="dev-panel" style="display: none;">
            <h2>Painel do Desenvolvedor (<span id="dev-name"></span>)</h2>
            
            <h3>Adicionar Novo Item</h3>
            <label for="item-folder">Pasta:</label>
            <select id="item-folder">
                <option value="projetos">Projetos</option>
                <option value="documentacao">Documentação</option>
                <option value="tutoriais">Tutoriais</option>
                <option value="midia">Mídia</option>
                <option value="diversos">Diversos</option>
            </select><br><br>
            
            <label for="file-type">Tipo:</label>
            <select id="file-type" onchange="toggleInputType()">
                <option value="link">Link</option>
                <option value="foto">Foto</option>
                <option value="video">Vídeo</option>
            </select><br><br>
            
            <label for="item-name">Nome do Item:</label>
            <input type="text" id="item-name" placeholder="Ex: Relatório Final" style="width: 100%; margin-bottom: 10px;"><br>
            
            <div id="dynamic-input-container">
                <label for="item-url">URL (Link):</label>
                <input type="text" id="item-url" placeholder="http://recurso.com/link" style="width: 100%; margin-bottom: 10px;">
            </div>
            
            <label>Visível para Usuário?</label>
            <input type="checkbox" id="item-visible" checked><br><br>
            
            <button onclick="addItem()">Adicionar Item</button>

            <hr>

            <h3>Arquivos Gerenciáveis por Pasta</h3>
            <div class="folder-selector" id="dev-folder-selector">
                </div>
            <div id="dev-file-list">
                </div>
            <button onclick="logout()">Sair</button>
        </div>

        <div id="user-view" style="display: none;">
            <h2>Visualização do Usuário</h2>
            <div class="folder-selector" id="user-folder-selector">
                </div>
            <div id="user-file-list">
                </div>
            <button onclick="logout()">Sair</button>
        </div>
    </div>

    <script>
        // --- Configurações ---
        const DEVELOPERS = {
            "dev01": "123", "dev02": "456", "dev03": "789", 
            "dev04": "101", "dev05": "112", "dev06": "131", 
            "dev07": "415", "dev08": "161"
        };
        const FOLDERS = {
            "projetos": "Projetos", "documentacao": "Documentação", "tutoriais": "Tutoriais", 
            "midia": "Mídia", "diversos": "Diversos"
        };
        
        let files = JSON.parse(localStorage.getItem('files')) || [];
        let currentUser = null; 
        let currentFolder = 'projetos'; 
        let fileDataUrl = null; // Armazena temporariamente a Data URL do arquivo

        // --- Funções Auxiliares ---

        function saveFiles() {
            localStorage.setItem('files', JSON.stringify(files));
        }

        function toggleInputType() {
            const type = document.getElementById('file-type').value;
            const container = document.getElementById('dynamic-input-container');
            
            if (type === 'link') {
                container.innerHTML = `
                    <label for="item-url">URL (Link):</label>
                    <input type="text" id="item-url" placeholder="http://recurso.com/link" style="width: 100%; margin-bottom: 10px;">
                `;
            } else {
                let acceptType = type === 'foto' ? 'image/*' : 'video/*';
                container.innerHTML = `
                    <label for="item-file">Carregar ${type.charAt(0).toUpperCase() + type.slice(1)}:</label>
                    <input type="file" id="item-file" accept="${acceptType}" onchange="handleFileUpload(event, '${type}')">
                `;
                fileDataUrl = null; // Limpa a URL anterior
            }
        }
        
        function handleFileUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            // Garante que o arquivo seja lido para a Data URL (Base64)
            const reader = new FileReader();
            reader.onload = function(e) {
                fileDataUrl = e.target.result; // Salva a Data URL
                alert(`Arquivo (${type}) carregado com sucesso!`);
            };
            reader.readAsDataURL(file);
        }

        function changeFolder(folderKey) {
            currentFolder = folderKey;
            updateFolderSelector('dev');
            updateFolderSelector('user');
            
            if (document.getElementById('dev-panel').style.display === 'block') {
                renderDevPanel();
            } else if (document.getElementById('user-view').style.display === 'block') {
                renderUserView();
            }
        }

        function updateFolderSelector(view) {
            const selectorDiv = document.getElementById(`${view}-folder-selector`);
            selectorDiv.innerHTML = '';
            for (const key in FOLDERS) {
                const button = document.createElement('button');
                button.textContent = FOLDERS[key];
                button.setAttribute('onclick', `changeFolder('${key}')`);
                if (key === currentFolder) {
                    button.classList.add('active');
                }
                selectorDiv.appendChild(button);
            }
        }

        // --- Renderização ---

        function renderDevPanel() {
            // ... (Função renderDevPanel permanece a mesma, pois o índice já foi corrigido) ...
            const devList = document.getElementById('dev-file-list');
            devList.innerHTML = '';
            
            const filesInFolder = files.filter(file => file.folder === currentFolder);

            if (filesInFolder.length === 0) {
                devList.innerHTML = `<p>Nenhum item na pasta "${FOLDERS[currentFolder]}" para gerenciar.</p>`;
                return;
            }
            
            filesInFolder.forEach(file => {
                const item = document.createElement('div');
                item.className = 'dev-item';
                
                // Busca o índice no array global `files`
                const originalIndex = files.findIndex(f => 
                    f.name === file.name && 
                    f.url === file.url && 
                    f.developer === file.developer && 
                    f.folder === file.folder
                );

                const visibilityText = file.visible ? 'Visível' : 'Oculto';
                
                item.innerHTML = `
                    <span>
                        <strong>[${file.type.toUpperCase()}]</strong> ${file.name}<br>
                        <span class="dev-info">Adicionado por: ${file.developer.toUpperCase()}</span> - *${visibilityText}*
                    </span>
                    <div>
                        <button onclick="toggleVisibility(${originalIndex})">${file.visible ? 'Ocultar' : 'Tornar Visível'}</button>
                        <button onclick="deleteItem(${originalIndex})">Excluir</button>
                    </div>
                `;
                devList.appendChild(item);
            });
        }

        function renderUserView() {
            const userList = document.getElementById('user-file-list');
            userList.innerHTML = '';
            
            const visibleFiles = files.filter(file => file.visible && file.folder === currentFolder);

            if (visibleFiles.length === 0) {
                userList.innerHTML = `<p>Nenhum arquivo ou link visível na pasta "${FOLDERS[currentFolder]}".</p>`;
                return;
            }
            
            visibleFiles.forEach(file => {
                const item = document.createElement('div');
                item.className = 'file-item';
                
                let contentHTML = `
                    <p>
                        <strong>[${file.type.toUpperCase()}]</strong> ${file.name}<br>
                        <span class="dev-info">Adicionado por: ${file.developer.toUpperCase()}</span>
                    </p>
                `;
                
                // Adiciona o elemento de mídia ou link
                if (file.type === 'link' || file.type === 'foto') {
                    contentHTML += `<a href="${file.url}" target="_blank">`;
                    if (file.type === 'link') {
                        contentHTML += `Acessar Link`;
                    } else if (file.type === 'foto') {
                        // Se for uma foto carregada (Data URL), exibe a imagem
                        if (file.url.startsWith('data:image')) {
                            contentHTML += `<img src="${file.url}" alt="${file.name}">`;
                        } else {
                            contentHTML += `Visualizar Foto (Link Externo)`;
                        }
                    }
                    contentHTML += `</a>`;
                } else if (file.type === 'video') {
                    // Se for um vídeo carregado (Data URL), exibe o player
                    if (file.url.startsWith('data:video')) {
                        contentHTML += `<video controls src="${file.url}"></video>`;
                    } else {
                        contentHTML += `<a href="${file.url}" target="_blank">Assistir Vídeo (Link Externo)</a>`;
                    }
                }
                
                item.innerHTML = contentHTML;
                userList.appendChild(item);
            });
        }

        // --- Funções de Ação (Desenvolvedor) ---

        function addItem() {
            const name = document.getElementById('item-name').value.trim();
            const type = document.getElementById('file-type').value;
            const folder = document.getElementById('item-folder').value; 
            const visible = document.getElementById('item-visible').checked;
            
            let url;

            if (type === 'link') {
                url = document.getElementById('item-url').value.trim();
            } else {
                // Se for foto/video, usa a Data URL temporária
                url = fileDataUrl; 
            }

            if (name === '' || !url) {
                alert(`Por favor, preencha o nome e ${type === 'link' ? 'a URL' : 'carregue o arquivo'}.`);
                return;
            }

            files.push({
                name: name,
                url: url, // Pode ser URL de link OU Data URL de arquivo
                type: type,
                folder: folder, 
                visible: visible,
                developer: currentUser 
            });

            saveFiles();
            
            // Muda a pasta atual para onde o item foi adicionado
            changeFolder(folder); 
            
            // Limpa os campos
            document.getElementById('item-name').value = '';
            if (type === 'link') {
                document.getElementById('item-url').value = '';
            }
            document.getElementById('item-visible').checked = true;
            fileDataUrl = null; // Limpa a URL temporária
            toggleInputType(); // Restaura o input para link

            alert(`Item adicionado com sucesso na pasta ${FOLDERS[folder]}!`);
        }
        
        // ... (Funções toggleVisibility, deleteItem, developerLogin, userLogin, logout permanecem as mesmas) ...
        function toggleVisibility(index) {
            files[index].visible = !files[index].visible;
            saveFiles();
            renderDevPanel(); 
        }

        function deleteItem(index) {
            if (confirm(`Tem certeza que deseja excluir o item: ${files[index].name}?`)) {
                files.splice(index, 1);
                saveFiles();
                renderDevPanel();
                alert('Item excluído.');
            }
        }

        function developerLogin() {
            const username = document.getElementById('username').value.toLowerCase().trim();
            const password = document.getElementById('password').value.trim();

            if (DEVELOPERS[username] && DEVELOPERS[username] === password) {
                currentUser = username;
                document.getElementById('dev-name').textContent = currentUser.toUpperCase();
                
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('user-view').style.display = 'none';
                document.getElementById('dev-panel').style.display = 'block';
                
                // Inicializa o input dinâmico
                toggleInputType();
                updateFolderSelector('dev');
                renderDevPanel();
            } else {
                alert('Credenciais de Desenvolvedor Inválidas.');
            }
        }

        function userLogin() {
            currentUser = 'user';
            
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('dev-panel').style.display = 'none';
            document.getElementById('user-view').style.display = 'block';
            
            updateFolderSelector('user');
            renderUserView();
        }

        function logout() {
            currentUser = null;
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('dev-panel').style.display = 'none';
            document.getElementById('user-view').style.display = 'none';

            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            currentFolder = 'projetos'; 
            fileDataUrl = null; // Garante que a URL temporária seja limpa ao sair
        }

        // Inicializa a página
        logout();
        toggleInputType(); // Chama para garantir que o input inicial seja Link
    </script>
</body>
</html>
